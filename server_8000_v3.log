INFO:     Will watch for changes in these directories: ['/Users/alan/GitHub/agent-platform']
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [43908] using WatchFiles
INFO:     Started server process [43966]
INFO:     Waiting for application startup.
2025-12-10 16:46:01,337 - apscheduler.scheduler - INFO - Scheduler started
2025-12-10 16:46:01,337 - app.services.scheduler_service - INFO - Ïä§ÏºÄÏ§ÑÎü¨ ÏãúÏûëÎê®
2025-12-10 16:46:01,337 - app.main - INFO - Scheduler started
2025-12-10 16:46:01,337 - apscheduler.scheduler - DEBUG - Looking for jobs to run
2025-12-10 16:46:01,337 - apscheduler.scheduler - DEBUG - No jobs; waiting until a job is added
INFO:     Application startup complete.
2025-12-10 16:46:08,937 - app.api.routes.assist - INFO - Analyze request for ticket 12345 (Tenant: test-tenant)
2025-12-10 16:46:08,939 - app.agents.retriever - INFO - Retrieving context via Gemini
2025-12-10 16:46:08,939 - app.services.gemini_file_search_client - INFO - üìù Conversation history: 0 turns
2025-12-10 16:46:08,939 - app.services.gemini_file_search_client - INFO -   [0] user: Test Ticket This is a test ticket description....
2025-12-10 16:46:08,939 - app.services.gemini_file_search_client - INFO - Built contents with 1 turns (history: 0)
2025-12-10 16:46:11,793 - app.agents.retriever - INFO - Context retrieval complete
2025-12-10 16:46:11,794 - app.agents.analyzer - INFO - Analyzing ticket
2025-12-10 16:46:11,923 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-fc110720-683c-4ea3-85db-b004d6fb30cc', 'json_data': {'messages': [{'role': 'system', 'content': '\n        You are an expert customer support analyzer. Analyze the ticket and return JSON with:\n        - intent: (inquiry, complaint, request, technical_issue)\n        - sentiment: (positive, neutral, negative, urgent)\n        - summary: 1-sentence summary in Korean\n        - key_entities: list of important entities\n        '}, {'role': 'user', 'content': '{"ticketId": "12345", "subject": "Test Ticket", "description": "This is a test ticket description.", "priority": null, "status": null, "tags": null, "streamProgress": false}'}], 'model': 'deepseek-chat', 'response_format': {'type': 'json_object'}, 'temperature': 0.3}}
2025-12-10 16:46:11,923 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.deepseek.com/chat/completions
2025-12-10 16:46:15,108 - openai._base_client - DEBUG - HTTP Response: POST https://api.deepseek.com/chat/completions "200 OK" Headers({'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'date': 'Wed, 10 Dec 2025 07:46:12 GMT', 'server': 'elb', 'content-encoding': 'gzip', 'vary': 'origin, access-control-request-method, access-control-request-headers', 'access-control-allow-credentials': 'true', 'x-ds-trace-id': '3f751af5e4453efc8cb3c323b8b1d0c8', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'x-cache': 'Miss from cloudfront', 'via': '1.1 da083e1f0c15d1726da737581424156c.cloudfront.net (CloudFront)', 'x-amz-cf-pop': 'ICN57-P6', 'x-amz-cf-id': 'oJPhFOtPnSPteooD9lvvx2PxMo6b4atkU7J9M3ZBllFgkfIttDpkrw=='})
2025-12-10 16:46:15,108 - openai._base_client - DEBUG - request_id: None
2025-12-10 16:46:15,116 - app.agents.analyzer - INFO - Analysis complete: inquiry
2025-12-10 16:46:15,117 - app.agents.resolver - INFO - Proposing solution
2025-12-10 16:46:15,124 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-b4882c99-c69e-43af-8877-b69c6661bc30', 'json_data': {'messages': [{'role': 'system', 'content': '\n        You are a helpful support agent. Based on the ticket and search results, \n        generate a response draft and suggest field updates.\n        \n        Return JSON with:\n        - draft_response: Polite, helpful response in Korean\n        - field_updates: { priority, status, type, tags } (only if changes needed)\n        - reasoning: Why you made these suggestions\n        '}, {'role': 'user', 'content': '{"ticket": {"ticketId": "12345", "subject": "Test Ticket", "description": "This is a test ticket description.", "priority": null, "status": null, "tags": null, "streamProgress": false}, "analysis": {"intent": "inquiry", "sentiment": "neutral", "summary": "ÌÖåÏä§Ìä∏ Ìã∞ÏºìÏóê ÎåÄÌïú ÏÑ§Î™ÖÏûÖÎãàÎã§.", "key_entities": ["ticketId: 12345", "subject: Test Ticket"]}, "similar_cases": [], "kb_articles": []}'}], 'model': 'deepseek-chat', 'response_format': {'type': 'json_object'}, 'temperature': 0.7}}
2025-12-10 16:46:15,124 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.deepseek.com/chat/completions
2025-12-10 16:46:25,345 - openai._base_client - DEBUG - HTTP Response: POST https://api.deepseek.com/chat/completions "200 OK" Headers({'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'date': 'Wed, 10 Dec 2025 07:46:15 GMT', 'server': 'elb', 'content-encoding': 'gzip', 'vary': 'origin, access-control-request-method, access-control-request-headers', 'access-control-allow-credentials': 'true', 'x-ds-trace-id': 'fcf21b0160aa3dc38dfadb75560ab5de', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'x-cache': 'Miss from cloudfront', 'via': '1.1 a88b766bf9d56d414da644158da6798e.cloudfront.net (CloudFront)', 'x-amz-cf-pop': 'ICN57-P4', 'x-amz-cf-id': 'WqvehZNkvYeE2UMXrM700CaCiAPRfffrjp2TDnxHfcdYnVXNZ3j20w=='})
2025-12-10 16:46:25,346 - openai._base_client - DEBUG - request_id: None
2025-12-10 16:46:25,348 - app.agents.resolver - INFO - Solution proposed
2025-12-10 16:46:25,350 - app.agents.approval - INFO - Checking approval status
2025-12-10 16:46:25,350 - app.agents.approval - INFO - Auto-approved (MVP)
2025-12-10 16:46:25,356 - app.repositories.proposal_repository - ERROR - Redis save failed, falling back to memory: Error 8 connecting to fly-agent-platform-redis.upstash.io:6379. nodename nor servname provided, or not known.
INFO:     127.0.0.1:51356 - "POST /api/assist/analyze HTTP/1.1" 200 OK
2025-12-10 16:46:32,354 - app.api.routes.assist - INFO - Analyze request for ticket 12345 (Tenant: test-tenant)
INFO:     127.0.0.1:51469 - "POST /api/assist/analyze HTTP/1.1" 200 OK
2025-12-10 16:46:32,355 - app.agents.retriever - INFO - Retrieving context via Gemini
2025-12-10 16:46:32,355 - app.services.gemini_file_search_client - INFO - üìù Conversation history: 0 turns
2025-12-10 16:46:32,355 - app.services.gemini_file_search_client - INFO -   [0] user: Test Ticket This is a test ticket description....
2025-12-10 16:46:32,355 - app.services.gemini_file_search_client - INFO - Built contents with 1 turns (history: 0)
2025-12-10 16:46:39,344 - app.agents.retriever - INFO - Context retrieval complete
2025-12-10 16:46:39,345 - app.agents.analyzer - INFO - Analyzing ticket
2025-12-10 16:46:39,352 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-7f9a5836-e132-4620-a93f-de0316b06006', 'json_data': {'messages': [{'role': 'system', 'content': '\n        You are an expert customer support analyzer. Analyze the ticket and return JSON with:\n        - intent: (inquiry, complaint, request, technical_issue)\n        - sentiment: (positive, neutral, negative, urgent)\n        - summary: 1-sentence summary in Korean\n        - key_entities: list of important entities\n        '}, {'role': 'user', 'content': '{"ticketId": "12345", "subject": "Test Ticket", "description": "This is a test ticket description.", "priority": null, "status": null, "tags": null, "streamProgress": true}'}], 'model': 'deepseek-chat', 'response_format': {'type': 'json_object'}, 'temperature': 0.3}}
2025-12-10 16:46:39,352 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.deepseek.com/chat/completions
2025-12-10 16:46:42,675 - openai._base_client - DEBUG - HTTP Response: POST https://api.deepseek.com/chat/completions "200 OK" Headers({'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'date': 'Wed, 10 Dec 2025 07:46:39 GMT', 'server': 'elb', 'content-encoding': 'gzip', 'vary': 'origin, access-control-request-method, access-control-request-headers', 'access-control-allow-credentials': 'true', 'x-ds-trace-id': '909b074cd897f4850c2cb96789434226', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'x-cache': 'Miss from cloudfront', 'via': '1.1 47d972c0543b96b8ef5a6c3258e80bf0.cloudfront.net (CloudFront)', 'x-amz-cf-pop': 'ICN57-P2', 'x-amz-cf-id': 'prA3cEZlIOqClRECtzooT3nKLqUQ2SsQLEg31JDs0kP_xVFh2WMbHw=='})
2025-12-10 16:46:42,675 - openai._base_client - DEBUG - request_id: None
2025-12-10 16:46:42,676 - app.agents.analyzer - INFO - Analysis complete: inquiry
2025-12-10 16:46:42,678 - app.agents.resolver - INFO - Proposing solution
2025-12-10 16:46:42,685 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-6b2f20d6-a463-4242-97cb-2432aa15329c', 'json_data': {'messages': [{'role': 'system', 'content': '\n        You are a helpful support agent. Based on the ticket and search results, \n        generate a response draft and suggest field updates.\n        \n        Return JSON with:\n        - draft_response: Polite, helpful response in Korean\n        - field_updates: { priority, status, type, tags } (only if changes needed)\n        - reasoning: Why you made these suggestions\n        '}, {'role': 'user', 'content': '{"ticket": {"ticketId": "12345", "subject": "Test Ticket", "description": "This is a test ticket description.", "priority": null, "status": null, "tags": null, "streamProgress": true}, "analysis": {"intent": "inquiry", "sentiment": "neutral", "summary": "ÌÖåÏä§Ìä∏ Ìã∞ÏºìÏóê ÎåÄÌïú ÏÑ§Î™ÖÏûÖÎãàÎã§.", "key_entities": ["ticketId: 12345", "subject: Test Ticket"]}, "similar_cases": [], "kb_articles": []}'}], 'model': 'deepseek-chat', 'response_format': {'type': 'json_object'}, 'temperature': 0.7}}
2025-12-10 16:46:42,685 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.deepseek.com/chat/completions
2025-12-10 16:46:53,123 - openai._base_client - DEBUG - HTTP Response: POST https://api.deepseek.com/chat/completions "200 OK" Headers({'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'date': 'Wed, 10 Dec 2025 07:46:42 GMT', 'server': 'elb', 'content-encoding': 'gzip', 'vary': 'origin, access-control-request-method, access-control-request-headers', 'access-control-allow-credentials': 'true', 'x-ds-trace-id': '8041627c2dcd00a46dd47e77733211e1', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'x-cache': 'Miss from cloudfront', 'via': '1.1 3e04bd2eb192dd88152d5177a42407f4.cloudfront.net (CloudFront)', 'x-amz-cf-pop': 'ICN80-P3', 'x-amz-cf-id': '_WKJA9dicYqiITgTvGducLY2KETXFEZ67ovMqK1n0yvyYbXx0WzKag=='})
2025-12-10 16:46:53,123 - openai._base_client - DEBUG - request_id: None
2025-12-10 16:46:53,123 - app.agents.resolver - INFO - Solution proposed
2025-12-10 16:46:53,124 - app.agents.approval - INFO - Checking approval status
2025-12-10 16:46:53,124 - app.agents.approval - INFO - Auto-approved (MVP)
WARNING:  WatchFiles detected changes in 'app/repositories/proposal_repository.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
2025-12-10 16:50:51,554 - app.services.scheduler_service - INFO - Ïä§ÏºÄÏ§ÑÎü¨ Ï¢ÖÎ£åÎê®
2025-12-10 16:50:51,555 - app.main - INFO - Scheduler stopped
2025-12-10 16:50:51,555 - apscheduler.scheduler - INFO - Scheduler has been shut down
INFO:     Application shutdown complete.
INFO:     Finished server process [43966]
INFO:     Started server process [50845]
INFO:     Waiting for application startup.
2025-12-10 16:50:52,392 - apscheduler.scheduler - INFO - Scheduler started
2025-12-10 16:50:52,392 - app.services.scheduler_service - INFO - Ïä§ÏºÄÏ§ÑÎü¨ ÏãúÏûëÎê®
2025-12-10 16:50:52,392 - app.main - INFO - Scheduler started
2025-12-10 16:50:52,392 - apscheduler.scheduler - DEBUG - Looking for jobs to run
2025-12-10 16:50:52,392 - apscheduler.scheduler - DEBUG - No jobs; waiting until a job is added
INFO:     Application startup complete.
INFO:     Shutting down
INFO:     Waiting for application shutdown.
2025-12-10 16:51:58,432 - app.services.scheduler_service - INFO - Ïä§ÏºÄÏ§ÑÎü¨ Ï¢ÖÎ£åÎê®
2025-12-10 16:51:58,432 - app.main - INFO - Scheduler stopped
2025-12-10 16:51:58,432 - apscheduler.scheduler - INFO - Scheduler has been shut down
INFO:     Application shutdown complete.
INFO:     Finished server process [50845]
INFO:     Stopping reloader process [43908]
